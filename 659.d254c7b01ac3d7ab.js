"use strict";(self.webpackChunkcoreui_free_angular_admin_template=self.webpackChunkcoreui_free_angular_admin_template||[]).push([[659],{8659:(ot,f,r)=>{r.r(f),r.d(f,{RegistroEstudiantesModule:()=>V});var u=r(6895),d=r(9299),l=r(4006),t=r(4650),x=r(8615),v=r(7185),R=r(1481),h=r(4859),m=r(9549),g=r(4144),_=r(4385),p=r(3238),T=r(7392),c=r(7155);function w(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"El nombre es requerido."),t.qZA())}function I(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"Los apellidos son requeridos"),t.qZA())}function E(o,n){if(1&o&&(t.TgZ(0,"mat-option",33),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.uid),t.xp6(1),t.hij(" ",e.name," ")}}function y(o,n){1&o&&(t.TgZ(0,"mat-error"),t._uU(1,"El maestro es requerido"),t.qZA())}function C(o,n){if(1&o&&(t.TgZ(0,"mat-option",33),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Z(o,n){1&o&&(t.TgZ(0,"mat-header-cell"),t._uU(1," Tipo documento "),t.qZA())}function M(o,n){if(1&o&&(t.TgZ(0,"mat-cell")(1,"div",5)(2,"div",8),t._uU(3),t.qZA()()()),2&o){const e=n.$implicit;t.xp6(3),t.hij(" ",e.type.name," ")}}function A(o,n){1&o&&(t.TgZ(0,"mat-header-cell"),t._uU(1," Ver "),t.qZA())}function D(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",37),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.showImage(s))}),t._uU(1," >view"),t.qZA()}}function N(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"mat-icon",38),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.showImage(s))}),t._uU(1," >visibility_off"),t.qZA()}}function U(o,n){if(1&o&&(t.TgZ(0,"mat-cell")(1,"button",34),t.YNc(2,D,2,0,"mat-icon",35),t.YNc(3,N,2,0,"mat-icon",36),t.qZA()()),2&o){const e=n.$implicit;t.xp6(2),t.Q6J("ngIf",!e.show),t.xp6(1),t.Q6J("ngIf",e.show)}}function J(o,n){1&o&&(t.TgZ(0,"mat-header-cell"),t._uU(1," Ver "),t.qZA())}function F(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",34)(1,"mat-icon",40),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.deleteItem(s))}),t._uU(2,"delete"),t.qZA()()}}function Q(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",34)(1,"mat-icon",40),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.deletePermanentlyImage(s))}),t._uU(2,"delete"),t.qZA()()}}function S(o,n){if(1&o&&(t.TgZ(0,"mat-cell"),t.YNc(1,F,3,0,"button",39),t.YNc(2,Q,3,0,"button",39),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",!e.nameImage),t.xp6(1),t.Q6J("ngIf",e.nameImage)}}function q(o,n){1&o&&(t.TgZ(0,"mat-header-cell"),t._uU(1," Imprimir "),t.qZA())}function Y(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",34)(1,"mat-icon",41),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit,a=t.oxw();return t.KtG(a.print(s))}),t._uU(2,"print"),t.qZA()()}}function k(o,n){if(1&o&&(t.TgZ(0,"mat-cell"),t.YNc(1,Y,3,0,"button",39),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Q6J("ngIf",e.nameImage)}}function O(o,n){1&o&&t._UZ(0,"mat-header-row")}function j(o,n){1&o&&t._UZ(0,"mat-row")}function B(o,n){if(1&o&&t._UZ(0,"object",45),2&o){const e=t.oxw(2);t.uIk("data",e.imgTemp,t.uOi)}}function $(o,n){if(1&o&&t._UZ(0,"img",46),2&o){const e=t.oxw(2);t.Q6J("src",e.imgTemp,t.LSH)}}function L(o,n){if(1&o&&t._UZ(0,"embed",47),2&o){const e=t.oxw(2);t.Q6J("src",e.imgTemp,t.uOi)}}function G(o,n){if(1&o&&(t.TgZ(0,"div",8),t.YNc(1,B,1,1,"object",42),t.YNc(2,$,1,1,"img",43),t.YNc(3,L,1,1,"embed",44),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isLocal),t.xp6(1),t.Q6J("ngIf",!e.isLocal&&"pdf"!=e.extension),t.xp6(1),t.Q6J("ngIf",!e.isLocal&&"pdf"==e.extension)}}let b=(()=>{class o{constructor(e,i,s,a,W){this.api=e,this.fb=i,this.toastr=s,this.route=a,this.sanitizer=W,this.session=localStorage.getItem("x-token"),this.imgTemp=null,this.teachers=[],this.documentTypes=[],this.documents=[],this.displayedColumns=["documentType","view","delete","print"],this.showDocument=!1,this.isLocal=!1,this.extension="",this.checkError=(tt,et)=>this.estudianteFormulario.controls[tt].hasError(et),this.estudianteFormulario=this.createFormGroup()}ngOnInit(){this.studentId=this.route.snapshot.paramMap.get("id"),this.getTeachers(),this.getDocumentTypes(),this.studentId&&this.getStudent()}createFormGroup(e){return this.fb.group({name:[e?.name||null,[l.kI.required]],lastname:[e?.lastname||null,[l.kI.required]],teacher:[e?.teacher._id||null,[l.kI.required]],documentType:null,img:null})}cambiarImagen(e){const{documentType:i}=this.estudianteFormulario.value;this.documents.push({type:i,image:e.target.files[0],src:this.sanitizer.bypassSecurityTrustResourceUrl(URL.createObjectURL(e.target.files[0])),show:!1}),this.documents=[...this.documents]}guardarRegistro(){this.api.post("students",this.estudianteFormulario.value).subscribe(e=>{this.studentId=e._id,this.toastr.success("SATISFACTORIO","REGISTRO GUARDADO EXISTOSAMENTE"),this.setImageStudent(),this.estudianteFormulario.reset()},e=>{console.log("error")})}editarEstudiante(){this.api.put(`students/${this.studentId}`,this.estudianteFormulario.value).subscribe(e=>{this.toastr.success("SATISFACTORIO","REGISTRO EDITADO EXISTOSAMENTE"),this.setImageStudent(),this.estudianteFormulario.reset()},e=>{this.toastr.error("Error!",e.error.msg)})}guardarImagen(e){const i=new FormData;i.append("archivo",e.image),this.api.post("uploads",i).subscribe(s=>{this.saveImageStudent(e,s.nombre)},s=>{this.toastr.error("Error!",s.error.msg)})}guardar(){this.estudianteFormulario.invalid?this.estudianteFormulario.markAllAsTouched():this.studentId?this.editarEstudiante():this.guardarRegistro()}setImageStudent(){this.documents.filter(e=>null!=e.image).forEach(e=>{this.guardarImagen(e)})}saveImageStudent(e,i){this.api.post("studentDocuments",{studenId:this.studentId,documentId:e.type.uid,documentName:i}).subscribe(s=>{this.documents=[]},s=>{this.toastr.error("Error!",s.error.msg)})}getStudent(){this.api.get(`students/${this.studentId}`).subscribe(e=>{this.estudianteFormulario=this.createFormGroup(e),this.getStudentDocument(this.studentId)},e=>{this.toastr.error(e.error.msg)})}getTeachers(){this.api.get("teacher").subscribe(e=>{this.teachers=e.teachers},e=>{this.toastr.error(e.error.msg)})}getDocumentTypes(){this.api.get("documentType").subscribe(e=>{this.documentTypes=e.documentsTypes},e=>{this.toastr.error(e.error.msg)})}getStudentDocument(e){this.api.get(`studentDocuments/${e}`).subscribe(i=>{this.documents=i.map(a=>({type:a.documentId,image:null,src:this.sanitizer.bypassSecurityTrustResourceUrl(this.api.getPathImage()+a.documentName),show:!1,nameImage:a.documentName}))},i=>{this.toastr.error(i.error.msg)})}getImage(e){this.api.get(`uploads/students/${e}`).subscribe(i=>{this.imgTemp=i},i=>{this.toastr.error(i.error.msg)})}showImage(e){e.show=!e.show,this.showDocument=!this.showDocument,this.imgTemp=null,e.show&&(this.imgTemp=e.src,e.image?this.isLocal=!0:(this.isLocal=!1,this.extension=e.nameImage.substr(e.nameImage.lastIndexOf(".")+1)))}deleteItem(e){this.documents=this.documents.filter(i=>i!==e),this.toastr.error("Archivo eliminado correctamente")}deletePermanentlyImage(e){this.api.delete(`uploads/students/${e.type._id}/${e.nameImage}`).subscribe(i=>{this.deleteItem(e),this.toastr.error("Archivo eliminado correctamente")},i=>{this.toastr.error(i.error.msg)})}print(e){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(x.s),t.Y36(l.qu),t.Y36(v._W),t.Y36(d.gz),t.Y36(R.H7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-registro-estudiantes"]],decls:72,vars:12,consts:[[1,"container","text-center"],[1,"row","justify-content-center",2,"font-size","13px"],[1,"col-12",3,"formGroup"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"row","align-items-center"],[1,"col-md-12"],["appearance","fill",1,"full-width"],["matInput","","placeholder","Pedro Luis","formControlName","name","autocomplete","off"],[4,"ngIf"],[1,"col-sm-12"],["matInput","","placeholder","Castillo Robles","formControlName","lastname","autocomplete","off"],["name","teacher","formControlName","teacher"],[3,"value",4,"ngFor","ngForOf"],["name","documentType","formControlName","documentType"],[1,"col-md-4"],["type","file","name","image","accept","image/*,.pdf",3,"change"],[1,"row","justify-content-center"],[1,"col-md-3","mt-2"],["mat-flat-button","","color","primary",3,"click"],[1,"table-responsive","mat-elevation-z8","student-container"],[3,"dataSource"],["matColumnDef","documentType"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","view"],["matColumnDef","delete"],["matColumnDef","print"],[4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["class","col-md-12",4,"ngIf"],[3,"value"],["mat-icon-button",""],["aria-hidden","false","aria-label","view","fontIcon","visibility","style","color: #3C4B64",3,"click",4,"ngIf"],["aria-hidden","false","aria-label","view","fontIcon","visibility_off","style","color: #3C4B64",3,"click",4,"ngIf"],["aria-hidden","false","aria-label","view","fontIcon","visibility",2,"color","#3C4B64",3,"click"],["aria-hidden","false","aria-label","view","fontIcon","visibility_off",2,"color","#3C4B64",3,"click"],["mat-icon-button","",4,"ngIf"],["fontIcon","delete",2,"color","#ED5E68",3,"click"],["fontIcon","print",2,"color","#3C4B64",3,"click"],["class","full-width","height","300",4,"ngIf"],["alt","50px","style","width: 100%; height: 220px;",3,"src",4,"ngIf"],["width","100%","height","220px;","type","application/pdf",3,"src",4,"ngIf"],["height","300",1,"full-width"],["alt","50px",2,"width","100%","height","220px",3,"src"],["width","100%","height","220px;","type","application/pdf",3,"src"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",3)(8,"div",4)(9,"h4"),t._uU(10,"Registro De Estudiantes"),t.qZA(),t.TgZ(11,"div",7)(12,"div",8)(13,"mat-form-field",9)(14,"mat-label"),t._uU(15,"Nombres "),t.qZA(),t._UZ(16,"input",10),t.YNc(17,w,2,0,"mat-error",11),t.qZA()(),t.TgZ(18,"div",12)(19,"mat-form-field",9)(20,"mat-label"),t._uU(21,"Apellidos"),t.qZA(),t._UZ(22,"input",13),t.YNc(23,I,2,0,"mat-error",11),t.qZA()()(),t.TgZ(24,"div",7)(25,"div",12)(26,"mat-form-field",9)(27,"mat-label"),t._uU(28,"Maestro "),t.qZA(),t.TgZ(29,"mat-select",14),t.YNc(30,E,2,2,"mat-option",15),t.qZA(),t.YNc(31,y,2,0,"mat-error",11),t.qZA()()(),t.TgZ(32,"div",7)(33,"div",12)(34,"mat-form-field",9)(35,"mat-label"),t._uU(36,"Tipo Documento "),t.qZA(),t.TgZ(37,"mat-select",16),t.YNc(38,C,2,2,"mat-option",15),t.qZA()()()(),t.TgZ(39,"div",5)(40,"div",17)(41,"input",18),t.NdJ("change",function(a){return i.cambiarImagen(a)}),t.qZA()()(),t.TgZ(42,"div",19)(43,"div",20)(44,"button",21),t.NdJ("click",function(){return i.guardar()}),t._uU(45),t.qZA()()()()()(),t.TgZ(46,"div",6)(47,"div",3)(48,"div",4)(49,"h4"),t._uU(50,"Listado Documentos Adjuntos"),t.qZA(),t.TgZ(51,"div",5)(52,"div",8)(53,"div",22)(54,"mat-table",23),t.ynx(55,24),t.YNc(56,Z,2,0,"mat-header-cell",25),t.YNc(57,M,4,1,"mat-cell",26),t.BQk(),t.ynx(58,27),t.YNc(59,A,2,0,"mat-header-cell",25),t.YNc(60,U,4,2,"mat-cell",26),t.BQk(),t.ynx(61,28),t.YNc(62,J,2,0,"mat-header-cell",25),t.YNc(63,S,3,2,"mat-cell",26),t.BQk(),t.ynx(64,29),t.YNc(65,q,2,0,"mat-header-cell",25),t.YNc(66,k,2,1,"mat-cell",26),t.BQk(),t.YNc(67,O,1,0,"mat-header-row",30),t.YNc(68,j,1,0,"mat-row",31),t.qZA()()()(),t.TgZ(69,"div",5),t.YNc(70,G,4,3,"div",32),t.qZA()()()()()()()()()(),t._UZ(71,"br")),2&e&&(t.xp6(2),t.Q6J("formGroup",i.estudianteFormulario),t.xp6(15),t.Q6J("ngIf",i.checkError("name","required")),t.xp6(6),t.Q6J("ngIf",i.checkError("lastname","required")),t.xp6(7),t.Q6J("ngForOf",i.teachers),t.xp6(1),t.Q6J("ngIf",i.checkError("teacher","required")),t.xp6(7),t.Q6J("ngForOf",i.documentTypes),t.xp6(7),t.Oqu(i.studentId?"EDITAR":"GUARDAR"),t.xp6(9),t.Q6J("dataSource",i.documents),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(2),t.Q6J("ngIf",i.showDocument))},dependencies:[u.sg,u.O5,l.Fj,l.JJ,l.JL,l.sg,l.u,h.lW,m.TO,m.KE,m.hX,g.Nt,_.gD,p.ey,T.Hw,c.BZ,c.fO,c.as,c.w1,c.Dz,c.nj,c.ge,c.ev,c.XQ,c.Gk],styles:[".student-container[_ngcontent-%COMP%]{max-height:200px;overflow:auto}"]}),o})();const H=[{path:"",redirectTo:"Estudiantes",pathMatch:"full"},{path:"Estudiantes",component:b},{path:"Estudiantes/:id",component:b}];let z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.Bz.forChild(H),d.Bz]}),o})(),P=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[p.BQ,p.BQ]}),o})();var K=r(529),X=r(3546);let V=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.ez,z,P,l.u5,K.JF,l.UX,X.QW,h.ot,m.lN,g.c,_.LD,T.Ps,c.p0]}),o})()}}]);